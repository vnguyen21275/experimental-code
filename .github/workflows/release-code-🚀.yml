name: Release the Latest Tag

# Invoke the workflow only when a tag is pushed to main
# AND after push-tag-ğŸï¸ is done
on:
  push:
    branches: [main]
    tags: ['*']
  workflow_run:
    workflows: [push-tag-ğŸï¸]
    types: [completed]

jobs:
  release_tag:
    name: Tagged Release 
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2.2.0
        with:
          fetch-depth: 0 # Required due to the weg Git works, without it this action won't be able to find any or the correct tags
      - name: Get Latest Tag
        id: latest_tag
        uses: "WyriHaximus/github-action-get-previous-tag@v1"

      - uses: marvinpinto/action-automatic-releases@v1.2.1
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          automatic_release_tag: ${{ steps.latest_tag.outputs.tag }}
          prerelease: false
          title: ${{ steps.latest_tag.outputs.tag }} Wacky Woohoo Pizza Time!!@! ğŸ•ğŸš€
